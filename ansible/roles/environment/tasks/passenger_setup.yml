---
- name: Apt | Add key for passenger repos
  apt_key: url=http://keyserver.ubuntu.com/pks/lookup?op=get&search=0x561F9B9CAC40B2F7 id=AC40B2F7 state=present
  become: yes

- name: Apt | Add support for https
  apt: pkg={{ item }} state=installed update_cache=yes cache_valid_time=3600
  become: yes
  with_items:
  - "apt-transport-https"
  - "ca-certificates"

- name: Apt | Add passenger repo
  apt_repository: repo='deb https://oss-binaries.phusionpassenger.com/apt/passenger {{ ansible_lsb.codename }} main' state=present update_cache=yes
  become: yes

- name: Pkg | Install nginx passenger packages
  apt: pkg={{ item }} state=installed
  become: yes
  with_items:
    - "nginx-extras"
    - "passenger"

- name: Service | Ensure nginx is running
  service: name=nginx state=started enabled=yes
  become: yes
